# Default values for ateliercode-server

replicaCount: 1

# Secret management
# Set to false if using SealedSecrets or external-secrets-operator
secrets:
  create: false  # We use SealedSecrets in production

image:
  repository: ghcr.io/jariahh/ateliercode-server
  pullPolicy: IfNotPresent
  tag: "2fb33ac"

imagePullSecrets: []
nameOverride: ""
fullnameOverride: ""

service:
  type: ClusterIP
  port: 8080

ingress:
  enabled: true
  className: nginx
  annotations:
    nginx.ingress.kubernetes.io/proxy-read-timeout: "3600"
    nginx.ingress.kubernetes.io/proxy-send-timeout: "3600"
    # WebSocket support
    nginx.ingress.kubernetes.io/proxy-http-version: "1.1"
    nginx.ingress.kubernetes.io/upstream-hash-by: "$remote_addr"
    cert-manager.io/cluster-issuer: "letsencrypt-prod"
  hosts:
    - host: ateliercode-server.rcmedicalspecialist.com
      paths:
        - path: /
          pathType: Prefix
  tls:
    - secretName: ateliercode-server-tls
      hosts:
        - ateliercode-server.rcmedicalspecialist.com

resources:
  limits:
    cpu: 500m
    memory: 512Mi
  requests:
    cpu: 100m
    memory: 128Mi

# Environment configuration
config:
  # JWT secret - MUST be overridden in production
  jwtSecret: ""
  jwtExpiresIn: "7d"

  # Database connection
  databaseUrl: ""

  # CORS - allowed origins (comma-separated)
  allowedOrigins: "https://ateliercode.rcmedicalspecialist.com,http://localhost:1420"

  # TURN/STUN servers (uses existing COTURN from RCMS)
  stunServers: "stun:app.rcmedicalspecialist.com:3478,stun:stun.l.google.com:19302"
  turnUrl: "turn:app.rcmedicalspecialist.com:3478"
  turnTcpUrl: "turn:app.rcmedicalspecialist.com:3478?transport=tcp"
  turnsUrl: "turns:app.rcmedicalspecialist.com:443"
  turnUsername: "rcms"
  # turnCredential - set via sealed secret

# PostgreSQL subchart
postgresql:
  enabled: true
  auth:
    username: ateliercode
    database: ateliercode
    password: "ateliercode-db-pass-2024"
    postgresPassword: "ateliercode-postgres-2024"
  image:
    registry: docker.io
    repository: bitnamisecure/postgresql
    tag: "latest"
  primary:
    persistence:
      enabled: true
      size: 1Gi

nodeSelector: {}
tolerations: []
affinity: {}
