{{/*
This is a placeholder for secrets.
In production, use SealedSecrets or external-secrets-operator and set secrets.create=false
*/}}
{{- if .Values.secrets.create }}
{{- if not (lookup "v1" "Secret" .Release.Namespace (printf "%s-secrets" (include "ateliercode-server.fullname" .))) }}
apiVersion: v1
kind: Secret
metadata:
  name: {{ include "ateliercode-server.fullname" . }}-secrets
  labels:
    {{- include "ateliercode-server.labels" . | nindent 4 }}
  annotations:
    "helm.sh/resource-policy": keep
type: Opaque
stringData:
  jwt-secret: {{ .Values.config.jwtSecret | default (randAlphaNum 64) | quote }}
  database-url: {{ .Values.config.databaseUrl | default (printf "postgresql://%s:%s@%s-postgresql:5432/%s" .Values.postgresql.auth.username "changeme" (include "ateliercode-server.fullname" .) .Values.postgresql.auth.database) | quote }}
  turn-credential: {{ .Values.config.turnCredential | default "" | quote }}
{{- end }}
{{- end }}
